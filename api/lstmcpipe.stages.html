
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

    <title>lstmcpipe.stages package &#8212; lstmcpipe 0.8.2 documentation</title>
    <link rel="stylesheet" type="text/css" href="../_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="../_static/alabaster.css" />
    <link rel="stylesheet" type="text/css" href="../_static/graphviz.css" />
    <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/doctools.js"></script>
    <script src="https://unpkg.com/mermaid/dist/mermaid.min.js"></script>
    <script>mermaid.initialize({startOnLoad:true});</script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="lstmcpipe.tests package" href="lstmcpipe.tests.html" />
    <link rel="prev" title="lstmcpipe.scripts.tests package" href="lstmcpipe.scripts.tests.html" />
   
  <link rel="stylesheet" href="../_static/custom.css" type="text/css" />
  
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head><body>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
  <section id="lstmcpipe-stages-package">
<h1>lstmcpipe.stages package<a class="headerlink" href="#lstmcpipe-stages-package" title="Permalink to this headline">¶</a></h1>
<section id="submodules">
<h2>Submodules<a class="headerlink" href="#submodules" title="Permalink to this headline">¶</a></h2>
</section>
<section id="module-lstmcpipe.stages.mc_dl1_to_dl2">
<span id="lstmcpipe-stages-mc-dl1-to-dl2-module"></span><h2>lstmcpipe.stages.mc_dl1_to_dl2 module<a class="headerlink" href="#module-lstmcpipe.stages.mc_dl1_to_dl2" title="Permalink to this headline">¶</a></h2>
<dl class="py function">
<dt class="sig sig-object py" id="lstmcpipe.stages.mc_dl1_to_dl2.batch_dl1_to_dl2">
<span class="sig-prename descclassname"><span class="pre">lstmcpipe.stages.mc_dl1_to_dl2.</span></span><span class="sig-name descname"><span class="pre">batch_dl1_to_dl2</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">dict_paths</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">config_file</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">jobid_from_training</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">batch_config</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">logs</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#lstmcpipe.stages.mc_dl1_to_dl2.batch_dl1_to_dl2" title="Permalink to this definition">¶</a></dt>
<dd><p>Function to batch the dl1_to_dl2 stage once the lstchain train_pipe batched jobs have finished.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>dict_paths</strong> (<em>dict</em>) – Core dictionary with {stage: PATHS} information</p></li>
<li><p><strong>config_file</strong> (<em>str</em>) – Path to a configuration file. If none is given, a standard configuration is applied</p></li>
<li><p><strong>jobid_from_training</strong> (<em>str</em>) – string containing the jobid from the jobs batched in the train_pipe stage, to be passed to the
dl1_to_dl2 function (as a slurm dependency)</p></li>
<li><p><strong>batch_config</strong> (<em>dict</em>) – Dictionary containing the (full) source_environment and the slurm_account strings to be passed to
dl1_dl2 function</p></li>
<li><p><strong>logs</strong> (<em>dict</em>) – Dictionary with logs files</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p><strong>jobid_for_dl2_to_dl3</strong> – string containing the jobids to be passed to the next stage of the workflow (as a slurm dependency)</p>
</dd>
<dt class="field-odd">Return type</dt>
<dd class="field-odd"><p>str</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="lstmcpipe.stages.mc_dl1_to_dl2.dl1_to_dl2">
<span class="sig-prename descclassname"><span class="pre">lstmcpipe.stages.mc_dl1_to_dl2.</span></span><span class="sig-name descname"><span class="pre">dl1_to_dl2</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">input_file</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">output_dir</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">path_models</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">config_file</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">wait_jobid_train_pipe</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">batch_configuration</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">''</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">slurm_options</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#lstmcpipe.stages.mc_dl1_to_dl2.dl1_to_dl2" title="Permalink to this definition">¶</a></dt>
<dd><p>Convert onsite files from dl1 to dl2</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>input_file</strong> (<em>str</em>) – FILE DL1 path</p></li>
<li><p><strong>output_dir</strong> (<em>str</em>) – DIR Dl2 path</p></li>
<li><p><strong>path_models</strong> (<em>str</em>) – DIR trained models path</p></li>
<li><p><strong>config_file</strong> (<em>str</em>) – Path to a configuration file. If none is given, a standard configuration is applied</p></li>
<li><p><strong>wait_jobid_train_pipe</strong> (<em>str</em>) – Comma-separated string with the batched jobid from the train stage to indicate the
dependencies of the current job to be batched</p></li>
<li><p><strong>batch_configuration</strong> (<em>dict</em>) – Dictionary containing the (full) source_environment and the slurm_account strings
to be passed to the sbatch commands
! NOTE : train_pipe AND dl1_to_dl2 MUST BE RUN WITH THE SAME ENVIRONMENT</p></li>
<li><p><strong>slurm_options</strong> (<em>str</em>) – Extra slurm options to be passed to the sbatch command</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p><ul class="simple">
<li><p><strong>log_dl1_to_dl2</strong> (<em>dict</em>) – log dictionary containing {jobid: batch_cmd} information</p></li>
<li><p><strong>jobid_dl1_to_dl2</strong> (<em>str</em>) – batched job_id to be passed to later stages</p></li>
</ul>
</p>
</dd>
</dl>
</dd></dl>

</section>
<section id="module-lstmcpipe.stages.mc_dl2_to_irfs">
<span id="lstmcpipe-stages-mc-dl2-to-irfs-module"></span><h2>lstmcpipe.stages.mc_dl2_to_irfs module<a class="headerlink" href="#module-lstmcpipe.stages.mc_dl2_to_irfs" title="Permalink to this headline">¶</a></h2>
<dl class="py function">
<dt class="sig sig-object py" id="lstmcpipe.stages.mc_dl2_to_irfs.batch_dl2_to_irfs">
<span class="sig-prename descclassname"><span class="pre">lstmcpipe.stages.mc_dl2_to_irfs.</span></span><span class="sig-name descname"><span class="pre">batch_dl2_to_irfs</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">dict_paths</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">config_file</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">job_ids_from_dl1_dl2</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">batch_config</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">logs</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#lstmcpipe.stages.mc_dl2_to_irfs.batch_dl2_to_irfs" title="Permalink to this definition">¶</a></dt>
<dd><p>Batches the dl2_to_irfs stage (lstchain lstchain_create_irf_files script) once the dl1_to_dl2 stage had finished.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>dict_paths</strong> (<em>dict</em>) – Core dictionary with {stage: PATHS} information</p></li>
<li><p><strong>config_file</strong> (<em>str</em>) – Path to lstchain-like config file</p></li>
<li><p><strong>job_ids_from_dl1_dl2</strong> (<em>str</em>) – Comma-separated string with the job ids from the dl1_to_dl2 stage to be used as a slurm dependency
to schedule the current stage</p></li>
<li><p><strong>batch_config</strong> (<em>dict</em>) – Dictionary containing the (full) source_environment and the slurm_account strings to be passed to
dl2_to_irfs function</p></li>
<li><p><strong>logs</strong> (<em>dict</em>) – Dictionary with logs files</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p><strong>jobs_from_dl2_irf</strong> – Comma-separated jobids batched in the current stage</p>
</dd>
<dt class="field-odd">Return type</dt>
<dd class="field-odd"><p>str</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="lstmcpipe.stages.mc_dl2_to_irfs.dl2_to_irfs">
<span class="sig-prename descclassname"><span class="pre">lstmcpipe.stages.mc_dl2_to_irfs.</span></span><span class="sig-name descname"><span class="pre">dl2_to_irfs</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">gamma_file</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">electron_file</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">proton_file</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">outfile</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">config_file</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">irf_point_like</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">batch_configuration</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">wait_jobs_dl1dl2</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">slurm_options</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#lstmcpipe.stages.mc_dl2_to_irfs.dl2_to_irfs" title="Permalink to this definition">¶</a></dt>
<dd><p>Batches interactively the lstchain <cite>lstchain_create_irf_files</cite> entry point.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>gamma_file</strong> (<em>str</em>) – </p></li>
<li><p><strong>electron_file</strong> (<em>str</em>) – </p></li>
<li><p><strong>proton_file</strong> (<em>str</em>) – </p></li>
<li><p><strong>outfile</strong> (<em>str</em>) – </p></li>
<li><p><strong>config_file</strong> (<em>str</em>) – Path to a configuration file. If none is given, a standard configuration is applied</p></li>
<li><p><strong>irf_point_like</strong> (<em>str</em>) – MC prod configuration argument to create IRFs: {True: gamma, False: gamma-diffuse}.</p></li>
<li><p><strong>batch_configuration</strong> (<em>dict</em>) – Dictionary containing the (full) source_environment and the slurm_account strings to be passed to the
sbatch commands</p></li>
<li><p><strong>wait_jobs_dl1dl2</strong> (<em>str</em>) – Comma separated string with the job ids of previous stages (dl1_to_dl2 stage) to be passed as dependencies to
the create_irfs_files job to be batched.</p></li>
<li><p><strong>slurm_options</strong> (<em>str</em>) – Extra slurm options to be passed to the sbatch command</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p><ul class="simple">
<li><p><strong>log_dl2_to_irfs</strong> (<em>dict</em>) – Dictionary-wise log containing {‘job_id’: ‘batched_cmd’} items</p></li>
<li><p><strong>job_id_dl2_irfs</strong> (<em>str</em>) – Job-id of the batched job to be passed to the last (MC prod check) stage of the workflow.</p></li>
</ul>
</p>
</dd>
</dl>
</dd></dl>

</section>
<section id="module-lstmcpipe.stages.mc_dl2_to_sensitivity">
<span id="lstmcpipe-stages-mc-dl2-to-sensitivity-module"></span><h2>lstmcpipe.stages.mc_dl2_to_sensitivity module<a class="headerlink" href="#module-lstmcpipe.stages.mc_dl2_to_sensitivity" title="Permalink to this headline">¶</a></h2>
<dl class="py function">
<dt class="sig sig-object py" id="lstmcpipe.stages.mc_dl2_to_sensitivity.batch_dl2_to_sensitivity">
<span class="sig-prename descclassname"><span class="pre">lstmcpipe.stages.mc_dl2_to_sensitivity.</span></span><span class="sig-name descname"><span class="pre">batch_dl2_to_sensitivity</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">dict_paths</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">job_ids_from_dl1_dl2</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">batch_config</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">logs</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#lstmcpipe.stages.mc_dl2_to_sensitivity.batch_dl2_to_sensitivity" title="Permalink to this definition">¶</a></dt>
<dd><p>Batches the dl2_to_sensitivity stage (<cite>stages.script_dl2_to_sensitivity</cite> based in the pyIRF iib) once the
dl1_to_dl2 stage had finished.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>dict_paths</strong> (<em>dict</em>) – Core dictionary with {stage: PATHS} information</p></li>
<li><p><strong>job_ids_from_dl1_dl2</strong> (<em>str</em>) – Comma-separated string with the job ids from the dl1_to_dl2 stage to be used as a slurm dependency
to schedule the current stage</p></li>
<li><p><strong>batch_config</strong> (<em>dict</em>) – Dictionary containing the (full) source_environment and the slurm_account strings to be passed to
dl2_to_sensitivity function</p></li>
<li><p><strong>logs</strong> (<em>dict</em>) – Dictionary with logs files</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p><strong>jobid_for_check</strong> – Comma-separated jobids batched in the current stage</p>
</dd>
<dt class="field-odd">Return type</dt>
<dd class="field-odd"><p>str</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="lstmcpipe.stages.mc_dl2_to_sensitivity.dl2_to_sensitivity">
<span class="sig-prename descclassname"><span class="pre">lstmcpipe.stages.mc_dl2_to_sensitivity.</span></span><span class="sig-name descname"><span class="pre">dl2_to_sensitivity</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">input_paths</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">output</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">batch_configuration</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">wait_jobs_dl1_dl2</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">slurm_options</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#lstmcpipe.stages.mc_dl2_to_sensitivity.dl2_to_sensitivity" title="Permalink to this definition">¶</a></dt>
<dd><p>Function to run the <cite>script_dl2_to_sensitivity</cite> for the gamma (and the different gamma offsets) and gamma-diffuse
particles.
Creates the sensitivity <a href="#id1"><span class="problematic" id="id2">*</span></a>.fits.gz files and the corresponding sensitivity curve plot.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>input_paths</strong> (<em>dict</em>) – </p></li>
<li><p><strong>output</strong> (<em>str</em>) – </p></li>
<li><p><strong>batch_configuration</strong> (<em>dict</em>) – Dictionary containing the (full) source_environment and the slurm_account strings to be passed to the
sbatch commands</p></li>
<li><p><strong>wait_jobs_dl1_dl2</strong> (<em>str</em>) – Comma-separated string with the jobs (dependency) to wait for before launching the cmd</p></li>
<li><p><strong>slurm_options</strong> (<em>str</em>) – Extra slurm options to be passed to the sbatch command</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p><ul class="simple">
<li><p><strong>log_dl2_to_sensitivity</strong> (<em>dict</em>) – Dictionary with job_id-slurm command key-value pair used for logging</p></li>
<li><p><strong>job_id</strong> (<em>str</em>) – String with job_ids batched by the dl2_to_sensitivity script</p></li>
</ul>
</p>
</dd>
</dl>
</dd></dl>

</section>
<section id="module-lstmcpipe.stages.mc_merge_dl1">
<span id="lstmcpipe-stages-mc-merge-dl1-module"></span><h2>lstmcpipe.stages.mc_merge_dl1 module<a class="headerlink" href="#module-lstmcpipe.stages.mc_merge_dl1" title="Permalink to this headline">¶</a></h2>
<dl class="py function">
<dt class="sig sig-object py" id="lstmcpipe.stages.mc_merge_dl1.batch_merge_dl1">
<span class="sig-prename descclassname"><span class="pre">lstmcpipe.stages.mc_merge_dl1.</span></span><span class="sig-name descname"><span class="pre">batch_merge_dl1</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">dict_paths</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">batch_config</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">logs</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">jobid_from_splitting</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">workflow_kind</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'lstchain'</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#lstmcpipe.stages.mc_merge_dl1.batch_merge_dl1" title="Permalink to this definition">¶</a></dt>
<dd><p>Function to batch the onsite_mc_merge_and_copy function once the all the r0_to_dl1 jobs (batched by particle type)
have finished.</p>
<p>Batch 8 merge_and_copy_dl1 jobs ([train, test] x particle) + the move_dl1 and move_dir jobs (2 per particle).</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>dict_paths</strong> (<em>dict</em>) – Core dictionary with {stage: PATHS} information</p></li>
<li><p><strong>batch_config</strong> (<em>dict</em>) – Dictionary containing the (full) source_environment and the slurm_account strings to be passed
to <cite>merge_dl1</cite> and <cite>compose_batch_command_of_script</cite> functions.</p></li>
<li><p><strong>workflow_kind</strong> (<em>str</em>) – Defines workflow kind (lstchain, ctapipe, hiperta)</p></li>
<li><p><strong>logs</strong> (<em>dict</em>) – Dictionary with logs files</p></li>
<li><p><strong>jobid_from_splitting</strong> (<em>str</em>) – </p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p><strong>jobids_for_train</strong> – Comma-separated str with all the job-ids to be passed to the next
stage of the workflow (as a slurm dependency)</p>
</dd>
<dt class="field-odd">Return type</dt>
<dd class="field-odd"><p>str</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="lstmcpipe.stages.mc_merge_dl1.merge_dl1">
<span class="sig-prename descclassname"><span class="pre">lstmcpipe.stages.mc_merge_dl1.</span></span><span class="sig-name descname"><span class="pre">merge_dl1</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">input_dir</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">output_file</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">batch_configuration</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">wait_jobs_split</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">''</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">merging_options</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">workflow_kind</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'lstchain'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">slurm_options</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#lstmcpipe.stages.mc_merge_dl1.merge_dl1" title="Permalink to this definition">¶</a></dt>
<dd><dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>input_dir</strong> (<em>str</em>) – </p></li>
<li><p><strong>output_file</strong> (<em>str</em>) – </p></li>
<li><p><strong>batch_configuration</strong> (<em>dict</em>) – </p></li>
<li><p><strong>wait_jobs_split</strong> (<em>str</em>) – </p></li>
<li><p><strong>merging_options</strong> (<em>dict</em>) – </p></li>
<li><p><strong>workflow_kind</strong> (<em>str</em>) – </p></li>
<li><p><strong>slurm_options</strong> (<em>str</em>) – Extra slurm options to be passed to the sbatch command</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p><ul class="simple">
<li><p><strong>log_merge</strong> (<em>dict</em>)</p></li>
<li><p><strong>jobid_merge</strong> (<em>str</em>)</p></li>
</ul>
</p>
</dd>
</dl>
</dd></dl>

</section>
<section id="module-lstmcpipe.stages.mc_process_dl1">
<span id="lstmcpipe-stages-mc-process-dl1-module"></span><h2>lstmcpipe.stages.mc_process_dl1 module<a class="headerlink" href="#module-lstmcpipe.stages.mc_process_dl1" title="Permalink to this headline">¶</a></h2>
<dl class="py function">
<dt class="sig sig-object py" id="lstmcpipe.stages.mc_process_dl1.batch_process_dl1">
<span class="sig-prename descclassname"><span class="pre">lstmcpipe.stages.mc_process_dl1.</span></span><span class="sig-name descname"><span class="pre">batch_process_dl1</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">dict_paths</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">conf_file</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">batch_config</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">logs</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">workflow_kind</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'lstchain'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">new_production</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">True</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#lstmcpipe.stages.mc_process_dl1.batch_process_dl1" title="Permalink to this definition">¶</a></dt>
<dd><p>Batch the dl1 processing jobs by particle type.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>dict_paths</strong> (<em>dict</em>) – Core dictionary with {stage: PATHS} information</p></li>
<li><p><strong>conf_file</strong> (<em>str</em>) – Path to a configuration file. If none is given, a standard configuration is applied</p></li>
<li><p><strong>batch_config</strong> (<em>dict</em>) – Dict with source environment (to select the desired conda environment to run the r0/1_to_dl1 stage),
and the slurm user account.</p></li>
<li><p><strong>workflow_kind</strong> (<em>str</em>) – One of the supported pipelines. Defines the command to be run on r0 files</p></li>
<li><p><strong>new_production</strong> (<em>bool</em>) – Whether to analysis simtel or reprocess existing dl1 files.</p></li>
<li><p><strong>logs</strong> (<em>dict</em>) – Dictionary con logs files</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p><strong>jobids_dl1_processing_stage</strong> – string, separated by commas, containing all the jobids of this stage</p>
</dd>
<dt class="field-odd">Return type</dt>
<dd class="field-odd"><p>str</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="lstmcpipe.stages.mc_process_dl1.r0_to_dl1">
<span class="sig-prename descclassname"><span class="pre">lstmcpipe.stages.mc_process_dl1.</span></span><span class="sig-name descname"><span class="pre">r0_to_dl1</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">input_dir</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">output_dir</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">workflow_kind</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'lstchain'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">config_file</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">batch_config</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">debug_mode</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">keep_rta_file</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">slurm_options</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#lstmcpipe.stages.mc_process_dl1.r0_to_dl1" title="Permalink to this definition">¶</a></dt>
<dd><p>R0 to DL1 MC onsite conversion.
Organizes files and launches slurm jobs in two slurm arrays.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>input_dir</strong> (<em>str</em><em> or </em><em>Path</em>) – path to the files directory to analyse</p></li>
<li><p><strong>output_dir</strong> (<em>str</em><em> or </em><em>Path</em>) – Output path to store files</p></li>
<li><p><strong>config_file</strong> (<em>str</em><em> or </em><em>Path</em>) – Path to the {lstchain, ctapipe, HiPeRTA} configuration file</p></li>
<li><p><strong>batch_config</strong> (<em>dict</em>) – Dictionary containing the full (source + env) source_environment and the slurm_account strings.
! NOTE : train_pipe AND dl1_to_dl2 <strong>MUST</strong> be run with the same environment.</p></li>
<li><p><strong>workflow_kind</strong> (<em>str</em>) – One of the supported pipelines. Defines the command to be run on r0 files</p></li>
<li><p><strong>slurm_options</strong> (<em>str</em>) – Extra slurm options to be passed</p></li>
<li><p><strong>ARGUMENTS</strong> (<em># HIPERTA</em>) – </p></li>
<li><p><strong>keep_rta_file</strong> (<em>bool</em>) – Flag to indicate whether to keep (keep_rta_file = True) or remove (keep_rta_file = Flase ) the
<cite>dl1v06_reorganized_*.h5</cite> output file (hiperta_r0_dl1 and re-organiser stages).
Argument to be passed to the hiperta_r0_to_dl1lstchain script.</p></li>
<li><p><strong>debug_mode</strong> (<em>bool</em>) – Flag to activate debug_mode. Only compatible with <cite>hiperta</cite> workflow kind, i.e.,
HiPeRTA functionality. DEFAULT=False.</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p><ul class="simple">
<li><p><strong>jobid2log</strong> (<em>dict</em>) – dictionary log containing {jobid: batch_cmd} information</p></li>
<li><p><em>jobids_r0_dl1</em> – A list of all the jobs sent for input dir</p></li>
</ul>
</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="lstmcpipe.stages.mc_process_dl1.reprocess_dl1">
<span class="sig-prename descclassname"><span class="pre">lstmcpipe.stages.mc_process_dl1.</span></span><span class="sig-name descname"><span class="pre">reprocess_dl1</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">input_dir</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">output_dir</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">workflow_kind</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'lstchain'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">config_file</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">batch_config</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">dl1_files_per_job</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">50</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">slurm_options</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#lstmcpipe.stages.mc_process_dl1.reprocess_dl1" title="Permalink to this definition">¶</a></dt>
<dd><p>Reprocessing of existing dl1 files.
Organizes files and launches slurm jobs in two slurm arrays.
The same train/test split performed with the earlier r0 to dl1
processing is used.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>input_dir</strong> (<em>str</em>) – path to the files directory to analyse</p></li>
<li><p><strong>output_dir</strong> (<em>str</em><em> or </em><em>Path</em>) – Output path to store files</p></li>
<li><p><strong>config_file</strong> (<em>str</em>) – Path to a configuration file. If none is given, the standard configuration of the selected pipeline is applied</p></li>
<li><p><strong>batch_config</strong> (<em>dict</em>) – Dictionary containing the (full) source_environment and the slurm_account strings.
! NOTE : train_pipe AND dl1_to_dl2 <strong>MUST</strong> be run with the same environment.</p></li>
<li><p><strong>workflow_kind</strong> (<em>str</em>) – One of the supported pipelines. Defines the command to be run on r0 files</p></li>
<li><p><strong>dl1_files_per_job</strong> (<em>int</em>) – Number of dl1 files to be processed per job array that was batched.</p></li>
<li><p><strong>slurm_options</strong> (<em>str</em>) – Extra slurm options to be passed to the sbatch command</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p><ul class="simple">
<li><p><strong>jobid2log</strong> (<em>dict</em>) – dictionary log containing {jobid: batch_cmd} information</p></li>
<li><p><em>jobids_dl1_dl1</em> – A list of all the jobs sent for input dir</p></li>
</ul>
</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="lstmcpipe.stages.mc_process_dl1.submit_dl1_jobs">
<span class="sig-prename descclassname"><span class="pre">lstmcpipe.stages.mc_process_dl1.</span></span><span class="sig-name descname"><span class="pre">submit_dl1_jobs</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">input_dir</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">output_dir</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">base_cmd</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">file_list</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">job_type_id</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">dl1_files_per_batched_job</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">job_logs_dir</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">slurm_account</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">filelist_name</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">n_jobs_parallel</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">100</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">dl1_processing</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'r0_dl1'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">slurm_options</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#lstmcpipe.stages.mc_process_dl1.submit_dl1_jobs" title="Permalink to this definition">¶</a></dt>
<dd><p>Compose sbatch command and batches it</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>input_dir</strong> (<em>str</em>) – </p></li>
<li><p><strong>output_dir</strong> (<em>str</em>) – </p></li>
<li><p><strong>base_cmd</strong> (<em>str</em>) – </p></li>
<li><p><strong>file_list</strong> (<em>list</em>) – </p></li>
<li><p><strong>job_type_id</strong> (<em>str</em>) – </p></li>
<li><p><strong>dl1_files_per_batched_job</strong> (<em>int</em>) – </p></li>
<li><p><strong>job_logs_dir</strong> (<em>Path</em>) – </p></li>
<li><p><strong>slurm_account</strong> (<em>str</em>) – </p></li>
<li><p><strong>filelist_name</strong> (<em>str</em>) – </p></li>
<li><p><strong>n_jobs_parallel</strong> (<em>int</em>) – </p></li>
<li><p><strong>dl1_processing</strong> (<em>str</em>) – </p></li>
<li><p><strong>slurm_options</strong> (<em>str</em>) – Extra slurm options to be passed</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p><ul class="simple">
<li><p><strong>jobid2log</strong> (<em>dict</em>)</p></li>
<li><p><strong>jobid</strong> (<em>str</em>)</p></li>
</ul>
</p>
</dd>
</dl>
</dd></dl>

</section>
<section id="module-lstmcpipe.stages.mc_train">
<span id="lstmcpipe-stages-mc-train-module"></span><h2>lstmcpipe.stages.mc_train module<a class="headerlink" href="#module-lstmcpipe.stages.mc_train" title="Permalink to this headline">¶</a></h2>
<dl class="py function">
<dt class="sig sig-object py" id="lstmcpipe.stages.mc_train.batch_plot_rf_features">
<span class="sig-prename descclassname"><span class="pre">lstmcpipe.stages.mc_train.</span></span><span class="sig-name descname"><span class="pre">batch_plot_rf_features</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">dict_paths</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">config_file</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">batch_configuration</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">train_jobid</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">logs</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#lstmcpipe.stages.mc_train.batch_plot_rf_features" title="Permalink to this definition">¶</a></dt>
<dd><p>Batches the plot_model_importance.py script that creates a .png with the RF feature’s importance models
after the RF are trained.
The plot is saved in the same dir in where the modes are stored.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>dict_paths</strong> (<em>dict</em>) – Core dictionary with {stage: PATHS} information</p>
</dd>
</dl>
<dl class="simple">
<dt>config_file: str</dt><dd><p>Path to lstchain config file</p>
</dd>
<dt>batch_configuration<span class="classifier">dict</span></dt><dd><p>Dictionary containing the (full) source_environment and the slurm_account strings.</p>
</dd>
<dt>train_jobid: str</dt><dd><p>Single jobid from training stage.</p>
</dd>
<dt>logs: dict</dt><dd><p>Dictionary with logs files</p>
</dd>
</dl>
<dl class="field-list simple">
<dt class="field-odd">Returns</dt>
<dd class="field-odd"><p><strong>jobid</strong> – jobid of batched stage</p>
</dd>
<dt class="field-even">Return type</dt>
<dd class="field-even"><p>str</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="lstmcpipe.stages.mc_train.batch_train_pipe">
<span class="sig-prename descclassname"><span class="pre">lstmcpipe.stages.mc_train.</span></span><span class="sig-name descname"><span class="pre">batch_train_pipe</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">dict_paths</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">jobids_from_merge</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">config_file</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">batch_config</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">logs</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#lstmcpipe.stages.mc_train.batch_train_pipe" title="Permalink to this definition">¶</a></dt>
<dd><p>Function to batch the lstchain train_pipe once the proton and gamma-diffuse merge_and_copy_dl1 batched jobs have
finished.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>dict_paths</strong> (<em>dict</em>) – Core dictionary with {stage: PATHS} information</p></li>
<li><p><strong>config_file</strong> (<em>str</em>) – Path to a configuration file. If none is given, a standard configuration is applied</p></li>
<li><p><strong>jobids_from_merge</strong> (<em>str</em>) – <dl class="simple">
<dt>string containing the jobids (<strong>*ONLY from proton and gamma-diffuse*</strong>) from the jobs batched in the</dt><dd><p>merge_and_copy_dl1 stage, to be passed to the train_pipe function (as a slurm dependency)</p>
</dd>
</dl>
</p></li>
<li><p><strong>batch_config</strong> (<em>dict</em>) – Dictionary containing the (full) source_environment and the slurm_account strings to be passed to
the <cite>train_pipe</cite> function.</p></li>
<li><p><strong>logs</strong> (<em>dict</em>) – Dictionary with logs files</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p><strong>jobid_4_dl1_to_dl2</strong> – string containing the jobid to be passed to the next stage of the workflow (as a slurm dependency).
For the next stage, however, it will be needed TRAIN + MERGED jobs</p>
</dd>
<dt class="field-odd">Return type</dt>
<dd class="field-odd"><p>str</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="lstmcpipe.stages.mc_train.train_pipe">
<span class="sig-prename descclassname"><span class="pre">lstmcpipe.stages.mc_train.</span></span><span class="sig-name descname"><span class="pre">train_pipe</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">gamma_dl1_train_file</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">proton_dl1_train_file</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">models_dir</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">config_file</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">batch_configuration</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">''</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">wait_jobs_dl1</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">slurm_options</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#lstmcpipe.stages.mc_train.train_pipe" title="Permalink to this definition">¶</a></dt>
<dd><p>Train RF from MC DL1 data (onsite LaPalma cluster)</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>gamma_dl1_train_file</strong> (<em>str</em>) – FILE path to the gamma</p></li>
<li><p><strong>proton_dl1_train_file</strong> (<em>str</em>) – FILE path to the proton</p></li>
<li><p><strong>models_dir</strong> – DIR trained models output path</p></li>
<li><p><strong>config_file</strong> (<em>str</em>) – Path to a configuration file. If none is given, a standard configuration is applied</p></li>
<li><p><strong>batch_configuration</strong> (<em>dict</em>) – Dictionary containing the (full) source_environment and the slurm_account strings to be passed to the
sbatch commands
! NOTE : train_pipe AND dl1_to_dl2 MUST BE RUN WITH THE SAME ENVIRONMENT</p></li>
<li><p><strong>wait_jobs_dl1</strong> (<em>str</em>) – A string (of chained job_ids separated by ‘,’ and without spaces between each element), containing
all the job_ids of the merging stage</p></li>
<li><p><strong>slurm_options</strong> (<em>str</em>) – Extra slurm options to be passed to the sbatch command</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p><ul class="simple">
<li><p><strong>log_train</strong> (<em>dict</em>) – dictionary containing the jobid of the batched job as key and the run command (the lstchain_mc_train
command with all its corresponding arguments) as value.</p></li>
<li><p><strong>jobid_train</strong> (<em>str</em>) – jobid of the batched job to be send (for dependencies purposes) to the next stage of the
workflow (onsite_mc_dl1_to_dl2)</p></li>
</ul>
</p>
</dd>
</dl>
</dd></dl>

</section>
<section id="module-lstmcpipe.stages.mc_train_test_splitting">
<span id="lstmcpipe-stages-mc-train-test-splitting-module"></span><h2>lstmcpipe.stages.mc_train_test_splitting module<a class="headerlink" href="#module-lstmcpipe.stages.mc_train_test_splitting" title="Permalink to this headline">¶</a></h2>
<dl class="py function">
<dt class="sig sig-object py" id="lstmcpipe.stages.mc_train_test_splitting.batch_train_test_splitting">
<span class="sig-prename descclassname"><span class="pre">lstmcpipe.stages.mc_train_test_splitting.</span></span><span class="sig-name descname"><span class="pre">batch_train_test_splitting</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">dict_paths</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">jobids_from_r0dl1</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">batch_config</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">logs</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#lstmcpipe.stages.mc_train_test_splitting.batch_train_test_splitting" title="Permalink to this definition">¶</a></dt>
<dd><dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>dict_paths</strong> (<em>dict</em>) – </p></li>
<li><p><strong>jobids_from_r0dl1</strong> (<em>str</em>) – </p></li>
<li><p><strong>batch_config</strong> (<em>dict</em>) – Dictionary containing the (full) source_environment and the slurm_account strings to be passed
to <cite>merge_dl1</cite> and <cite>compose_batch_command_of_script</cite> functions.</p></li>
<li><p><strong>logs</strong> (<em>dict</em>) – Dictionary with logs files</p></li>
</ul>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="lstmcpipe.stages.mc_train_test_splitting.check_empty_dir">
<span class="sig-prename descclassname"><span class="pre">lstmcpipe.stages.mc_train_test_splitting.</span></span><span class="sig-name descname"><span class="pre">check_empty_dir</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">directory</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#lstmcpipe.stages.mc_train_test_splitting.check_empty_dir" title="Permalink to this definition">¶</a></dt>
<dd><p>Check if a directory is empty. If not, erase all its content.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>directory</strong> (<em>Path</em>) – Path to dir to check</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="lstmcpipe.stages.mc_train_test_splitting.train_test_split">
<span class="sig-prename descclassname"><span class="pre">lstmcpipe.stages.mc_train_test_splitting.</span></span><span class="sig-name descname"><span class="pre">train_test_split</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">input_dir</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">output_dirs</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">batch_configuration</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">wait_jobid_r0_dl1</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">slurm_options</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#lstmcpipe.stages.mc_train_test_splitting.train_test_split" title="Permalink to this definition">¶</a></dt>
<dd><dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>input_dir</strong> (<em>str</em>) – </p></li>
<li><p><strong>output_dirs</strong> (<em>dict</em>) – </p></li>
<li><p><strong>batch_configuration</strong> (<em>dict</em>) – </p></li>
<li><p><strong>wait_jobid_r0_dl1</strong> (<em>str</em>) – </p></li>
<li><p><strong>slurm_options</strong> (<em>str</em>) – Extra slurm options to be passed to the sbatch command</p></li>
</ul>
</dd>
</dl>
</dd></dl>

</section>
<section id="module-lstmcpipe.stages">
<span id="module-contents"></span><h2>Module contents<a class="headerlink" href="#module-lstmcpipe.stages" title="Permalink to this headline">¶</a></h2>
<dl class="py function">
<dt class="sig sig-object py" id="lstmcpipe.stages.batch_dl1_to_dl2">
<span class="sig-prename descclassname"><span class="pre">lstmcpipe.stages.</span></span><span class="sig-name descname"><span class="pre">batch_dl1_to_dl2</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">dict_paths</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">config_file</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">jobid_from_training</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">batch_config</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">logs</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#lstmcpipe.stages.batch_dl1_to_dl2" title="Permalink to this definition">¶</a></dt>
<dd><p>Function to batch the dl1_to_dl2 stage once the lstchain train_pipe batched jobs have finished.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>dict_paths</strong> (<em>dict</em>) – Core dictionary with {stage: PATHS} information</p></li>
<li><p><strong>config_file</strong> (<em>str</em>) – Path to a configuration file. If none is given, a standard configuration is applied</p></li>
<li><p><strong>jobid_from_training</strong> (<em>str</em>) – string containing the jobid from the jobs batched in the train_pipe stage, to be passed to the
dl1_to_dl2 function (as a slurm dependency)</p></li>
<li><p><strong>batch_config</strong> (<em>dict</em>) – Dictionary containing the (full) source_environment and the slurm_account strings to be passed to
dl1_dl2 function</p></li>
<li><p><strong>logs</strong> (<em>dict</em>) – Dictionary with logs files</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p><strong>jobid_for_dl2_to_dl3</strong> – string containing the jobids to be passed to the next stage of the workflow (as a slurm dependency)</p>
</dd>
<dt class="field-odd">Return type</dt>
<dd class="field-odd"><p>str</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="lstmcpipe.stages.batch_dl2_to_irfs">
<span class="sig-prename descclassname"><span class="pre">lstmcpipe.stages.</span></span><span class="sig-name descname"><span class="pre">batch_dl2_to_irfs</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">dict_paths</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">config_file</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">job_ids_from_dl1_dl2</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">batch_config</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">logs</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#lstmcpipe.stages.batch_dl2_to_irfs" title="Permalink to this definition">¶</a></dt>
<dd><p>Batches the dl2_to_irfs stage (lstchain lstchain_create_irf_files script) once the dl1_to_dl2 stage had finished.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>dict_paths</strong> (<em>dict</em>) – Core dictionary with {stage: PATHS} information</p></li>
<li><p><strong>config_file</strong> (<em>str</em>) – Path to lstchain-like config file</p></li>
<li><p><strong>job_ids_from_dl1_dl2</strong> (<em>str</em>) – Comma-separated string with the job ids from the dl1_to_dl2 stage to be used as a slurm dependency
to schedule the current stage</p></li>
<li><p><strong>batch_config</strong> (<em>dict</em>) – Dictionary containing the (full) source_environment and the slurm_account strings to be passed to
dl2_to_irfs function</p></li>
<li><p><strong>logs</strong> (<em>dict</em>) – Dictionary with logs files</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p><strong>jobs_from_dl2_irf</strong> – Comma-separated jobids batched in the current stage</p>
</dd>
<dt class="field-odd">Return type</dt>
<dd class="field-odd"><p>str</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="lstmcpipe.stages.batch_dl2_to_sensitivity">
<span class="sig-prename descclassname"><span class="pre">lstmcpipe.stages.</span></span><span class="sig-name descname"><span class="pre">batch_dl2_to_sensitivity</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">dict_paths</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">job_ids_from_dl1_dl2</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">batch_config</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">logs</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#lstmcpipe.stages.batch_dl2_to_sensitivity" title="Permalink to this definition">¶</a></dt>
<dd><p>Batches the dl2_to_sensitivity stage (<cite>stages.script_dl2_to_sensitivity</cite> based in the pyIRF iib) once the
dl1_to_dl2 stage had finished.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>dict_paths</strong> (<em>dict</em>) – Core dictionary with {stage: PATHS} information</p></li>
<li><p><strong>job_ids_from_dl1_dl2</strong> (<em>str</em>) – Comma-separated string with the job ids from the dl1_to_dl2 stage to be used as a slurm dependency
to schedule the current stage</p></li>
<li><p><strong>batch_config</strong> (<em>dict</em>) – Dictionary containing the (full) source_environment and the slurm_account strings to be passed to
dl2_to_sensitivity function</p></li>
<li><p><strong>logs</strong> (<em>dict</em>) – Dictionary with logs files</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p><strong>jobid_for_check</strong> – Comma-separated jobids batched in the current stage</p>
</dd>
<dt class="field-odd">Return type</dt>
<dd class="field-odd"><p>str</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="lstmcpipe.stages.batch_merge_dl1">
<span class="sig-prename descclassname"><span class="pre">lstmcpipe.stages.</span></span><span class="sig-name descname"><span class="pre">batch_merge_dl1</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">dict_paths</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">batch_config</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">logs</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">jobid_from_splitting</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">workflow_kind</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'lstchain'</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#lstmcpipe.stages.batch_merge_dl1" title="Permalink to this definition">¶</a></dt>
<dd><p>Function to batch the onsite_mc_merge_and_copy function once the all the r0_to_dl1 jobs (batched by particle type)
have finished.</p>
<p>Batch 8 merge_and_copy_dl1 jobs ([train, test] x particle) + the move_dl1 and move_dir jobs (2 per particle).</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>dict_paths</strong> (<em>dict</em>) – Core dictionary with {stage: PATHS} information</p></li>
<li><p><strong>batch_config</strong> (<em>dict</em>) – Dictionary containing the (full) source_environment and the slurm_account strings to be passed
to <cite>merge_dl1</cite> and <cite>compose_batch_command_of_script</cite> functions.</p></li>
<li><p><strong>workflow_kind</strong> (<em>str</em>) – Defines workflow kind (lstchain, ctapipe, hiperta)</p></li>
<li><p><strong>logs</strong> (<em>dict</em>) – Dictionary with logs files</p></li>
<li><p><strong>jobid_from_splitting</strong> (<em>str</em>) – </p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p><strong>jobids_for_train</strong> – Comma-separated str with all the job-ids to be passed to the next
stage of the workflow (as a slurm dependency)</p>
</dd>
<dt class="field-odd">Return type</dt>
<dd class="field-odd"><p>str</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="lstmcpipe.stages.batch_plot_rf_features">
<span class="sig-prename descclassname"><span class="pre">lstmcpipe.stages.</span></span><span class="sig-name descname"><span class="pre">batch_plot_rf_features</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">dict_paths</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">config_file</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">batch_configuration</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">train_jobid</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">logs</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#lstmcpipe.stages.batch_plot_rf_features" title="Permalink to this definition">¶</a></dt>
<dd><p>Batches the plot_model_importance.py script that creates a .png with the RF feature’s importance models
after the RF are trained.
The plot is saved in the same dir in where the modes are stored.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>dict_paths</strong> (<em>dict</em>) – Core dictionary with {stage: PATHS} information</p>
</dd>
</dl>
<dl class="simple">
<dt>config_file: str</dt><dd><p>Path to lstchain config file</p>
</dd>
<dt>batch_configuration<span class="classifier">dict</span></dt><dd><p>Dictionary containing the (full) source_environment and the slurm_account strings.</p>
</dd>
<dt>train_jobid: str</dt><dd><p>Single jobid from training stage.</p>
</dd>
<dt>logs: dict</dt><dd><p>Dictionary with logs files</p>
</dd>
</dl>
<dl class="field-list simple">
<dt class="field-odd">Returns</dt>
<dd class="field-odd"><p><strong>jobid</strong> – jobid of batched stage</p>
</dd>
<dt class="field-even">Return type</dt>
<dd class="field-even"><p>str</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="lstmcpipe.stages.batch_process_dl1">
<span class="sig-prename descclassname"><span class="pre">lstmcpipe.stages.</span></span><span class="sig-name descname"><span class="pre">batch_process_dl1</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">dict_paths</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">conf_file</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">batch_config</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">logs</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">workflow_kind</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'lstchain'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">new_production</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">True</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#lstmcpipe.stages.batch_process_dl1" title="Permalink to this definition">¶</a></dt>
<dd><p>Batch the dl1 processing jobs by particle type.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>dict_paths</strong> (<em>dict</em>) – Core dictionary with {stage: PATHS} information</p></li>
<li><p><strong>conf_file</strong> (<em>str</em>) – Path to a configuration file. If none is given, a standard configuration is applied</p></li>
<li><p><strong>batch_config</strong> (<em>dict</em>) – Dict with source environment (to select the desired conda environment to run the r0/1_to_dl1 stage),
and the slurm user account.</p></li>
<li><p><strong>workflow_kind</strong> (<em>str</em>) – One of the supported pipelines. Defines the command to be run on r0 files</p></li>
<li><p><strong>new_production</strong> (<em>bool</em>) – Whether to analysis simtel or reprocess existing dl1 files.</p></li>
<li><p><strong>logs</strong> (<em>dict</em>) – Dictionary con logs files</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p><strong>jobids_dl1_processing_stage</strong> – string, separated by commas, containing all the jobids of this stage</p>
</dd>
<dt class="field-odd">Return type</dt>
<dd class="field-odd"><p>str</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="lstmcpipe.stages.batch_train_pipe">
<span class="sig-prename descclassname"><span class="pre">lstmcpipe.stages.</span></span><span class="sig-name descname"><span class="pre">batch_train_pipe</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">dict_paths</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">jobids_from_merge</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">config_file</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">batch_config</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">logs</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#lstmcpipe.stages.batch_train_pipe" title="Permalink to this definition">¶</a></dt>
<dd><p>Function to batch the lstchain train_pipe once the proton and gamma-diffuse merge_and_copy_dl1 batched jobs have
finished.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>dict_paths</strong> (<em>dict</em>) – Core dictionary with {stage: PATHS} information</p></li>
<li><p><strong>config_file</strong> (<em>str</em>) – Path to a configuration file. If none is given, a standard configuration is applied</p></li>
<li><p><strong>jobids_from_merge</strong> (<em>str</em>) – <dl class="simple">
<dt>string containing the jobids (<strong>*ONLY from proton and gamma-diffuse*</strong>) from the jobs batched in the</dt><dd><p>merge_and_copy_dl1 stage, to be passed to the train_pipe function (as a slurm dependency)</p>
</dd>
</dl>
</p></li>
<li><p><strong>batch_config</strong> (<em>dict</em>) – Dictionary containing the (full) source_environment and the slurm_account strings to be passed to
the <cite>train_pipe</cite> function.</p></li>
<li><p><strong>logs</strong> (<em>dict</em>) – Dictionary with logs files</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p><strong>jobid_4_dl1_to_dl2</strong> – string containing the jobid to be passed to the next stage of the workflow (as a slurm dependency).
For the next stage, however, it will be needed TRAIN + MERGED jobs</p>
</dd>
<dt class="field-odd">Return type</dt>
<dd class="field-odd"><p>str</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="lstmcpipe.stages.batch_train_test_splitting">
<span class="sig-prename descclassname"><span class="pre">lstmcpipe.stages.</span></span><span class="sig-name descname"><span class="pre">batch_train_test_splitting</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">dict_paths</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">jobids_from_r0dl1</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">batch_config</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">logs</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#lstmcpipe.stages.batch_train_test_splitting" title="Permalink to this definition">¶</a></dt>
<dd><dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>dict_paths</strong> (<em>dict</em>) – </p></li>
<li><p><strong>jobids_from_r0dl1</strong> (<em>str</em>) – </p></li>
<li><p><strong>batch_config</strong> (<em>dict</em>) – Dictionary containing the (full) source_environment and the slurm_account strings to be passed
to <cite>merge_dl1</cite> and <cite>compose_batch_command_of_script</cite> functions.</p></li>
<li><p><strong>logs</strong> (<em>dict</em>) – Dictionary with logs files</p></li>
</ul>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="lstmcpipe.stages.dl1_to_dl2">
<span class="sig-prename descclassname"><span class="pre">lstmcpipe.stages.</span></span><span class="sig-name descname"><span class="pre">dl1_to_dl2</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">input_file</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">output_dir</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">path_models</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">config_file</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">wait_jobid_train_pipe</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">batch_configuration</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">''</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">slurm_options</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#lstmcpipe.stages.dl1_to_dl2" title="Permalink to this definition">¶</a></dt>
<dd><p>Convert onsite files from dl1 to dl2</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>input_file</strong> (<em>str</em>) – FILE DL1 path</p></li>
<li><p><strong>output_dir</strong> (<em>str</em>) – DIR Dl2 path</p></li>
<li><p><strong>path_models</strong> (<em>str</em>) – DIR trained models path</p></li>
<li><p><strong>config_file</strong> (<em>str</em>) – Path to a configuration file. If none is given, a standard configuration is applied</p></li>
<li><p><strong>wait_jobid_train_pipe</strong> (<em>str</em>) – Comma-separated string with the batched jobid from the train stage to indicate the
dependencies of the current job to be batched</p></li>
<li><p><strong>batch_configuration</strong> (<em>dict</em>) – Dictionary containing the (full) source_environment and the slurm_account strings
to be passed to the sbatch commands
! NOTE : train_pipe AND dl1_to_dl2 MUST BE RUN WITH THE SAME ENVIRONMENT</p></li>
<li><p><strong>slurm_options</strong> (<em>str</em>) – Extra slurm options to be passed to the sbatch command</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p><ul class="simple">
<li><p><strong>log_dl1_to_dl2</strong> (<em>dict</em>) – log dictionary containing {jobid: batch_cmd} information</p></li>
<li><p><strong>jobid_dl1_to_dl2</strong> (<em>str</em>) – batched job_id to be passed to later stages</p></li>
</ul>
</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="lstmcpipe.stages.dl2_to_irfs">
<span class="sig-prename descclassname"><span class="pre">lstmcpipe.stages.</span></span><span class="sig-name descname"><span class="pre">dl2_to_irfs</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">gamma_file</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">electron_file</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">proton_file</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">outfile</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">config_file</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">irf_point_like</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">batch_configuration</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">wait_jobs_dl1dl2</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">slurm_options</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#lstmcpipe.stages.dl2_to_irfs" title="Permalink to this definition">¶</a></dt>
<dd><p>Batches interactively the lstchain <cite>lstchain_create_irf_files</cite> entry point.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>gamma_file</strong> (<em>str</em>) – </p></li>
<li><p><strong>electron_file</strong> (<em>str</em>) – </p></li>
<li><p><strong>proton_file</strong> (<em>str</em>) – </p></li>
<li><p><strong>outfile</strong> (<em>str</em>) – </p></li>
<li><p><strong>config_file</strong> (<em>str</em>) – Path to a configuration file. If none is given, a standard configuration is applied</p></li>
<li><p><strong>irf_point_like</strong> (<em>str</em>) – MC prod configuration argument to create IRFs: {True: gamma, False: gamma-diffuse}.</p></li>
<li><p><strong>batch_configuration</strong> (<em>dict</em>) – Dictionary containing the (full) source_environment and the slurm_account strings to be passed to the
sbatch commands</p></li>
<li><p><strong>wait_jobs_dl1dl2</strong> (<em>str</em>) – Comma separated string with the job ids of previous stages (dl1_to_dl2 stage) to be passed as dependencies to
the create_irfs_files job to be batched.</p></li>
<li><p><strong>slurm_options</strong> (<em>str</em>) – Extra slurm options to be passed to the sbatch command</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p><ul class="simple">
<li><p><strong>log_dl2_to_irfs</strong> (<em>dict</em>) – Dictionary-wise log containing {‘job_id’: ‘batched_cmd’} items</p></li>
<li><p><strong>job_id_dl2_irfs</strong> (<em>str</em>) – Job-id of the batched job to be passed to the last (MC prod check) stage of the workflow.</p></li>
</ul>
</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="lstmcpipe.stages.dl2_to_sensitivity">
<span class="sig-prename descclassname"><span class="pre">lstmcpipe.stages.</span></span><span class="sig-name descname"><span class="pre">dl2_to_sensitivity</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">input_paths</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">output</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">batch_configuration</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">wait_jobs_dl1_dl2</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">slurm_options</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#lstmcpipe.stages.dl2_to_sensitivity" title="Permalink to this definition">¶</a></dt>
<dd><p>Function to run the <cite>script_dl2_to_sensitivity</cite> for the gamma (and the different gamma offsets) and gamma-diffuse
particles.
Creates the sensitivity <a href="#id3"><span class="problematic" id="id4">*</span></a>.fits.gz files and the corresponding sensitivity curve plot.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>input_paths</strong> (<em>dict</em>) – </p></li>
<li><p><strong>output</strong> (<em>str</em>) – </p></li>
<li><p><strong>batch_configuration</strong> (<em>dict</em>) – Dictionary containing the (full) source_environment and the slurm_account strings to be passed to the
sbatch commands</p></li>
<li><p><strong>wait_jobs_dl1_dl2</strong> (<em>str</em>) – Comma-separated string with the jobs (dependency) to wait for before launching the cmd</p></li>
<li><p><strong>slurm_options</strong> (<em>str</em>) – Extra slurm options to be passed to the sbatch command</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p><ul class="simple">
<li><p><strong>log_dl2_to_sensitivity</strong> (<em>dict</em>) – Dictionary with job_id-slurm command key-value pair used for logging</p></li>
<li><p><strong>job_id</strong> (<em>str</em>) – String with job_ids batched by the dl2_to_sensitivity script</p></li>
</ul>
</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="lstmcpipe.stages.merge_dl1">
<span class="sig-prename descclassname"><span class="pre">lstmcpipe.stages.</span></span><span class="sig-name descname"><span class="pre">merge_dl1</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">input_dir</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">output_file</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">batch_configuration</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">wait_jobs_split</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">''</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">merging_options</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">workflow_kind</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'lstchain'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">slurm_options</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#lstmcpipe.stages.merge_dl1" title="Permalink to this definition">¶</a></dt>
<dd><dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>input_dir</strong> (<em>str</em>) – </p></li>
<li><p><strong>output_file</strong> (<em>str</em>) – </p></li>
<li><p><strong>batch_configuration</strong> (<em>dict</em>) – </p></li>
<li><p><strong>wait_jobs_split</strong> (<em>str</em>) – </p></li>
<li><p><strong>merging_options</strong> (<em>dict</em>) – </p></li>
<li><p><strong>workflow_kind</strong> (<em>str</em>) – </p></li>
<li><p><strong>slurm_options</strong> (<em>str</em>) – Extra slurm options to be passed to the sbatch command</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p><ul class="simple">
<li><p><strong>log_merge</strong> (<em>dict</em>)</p></li>
<li><p><strong>jobid_merge</strong> (<em>str</em>)</p></li>
</ul>
</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="lstmcpipe.stages.r0_to_dl1">
<span class="sig-prename descclassname"><span class="pre">lstmcpipe.stages.</span></span><span class="sig-name descname"><span class="pre">r0_to_dl1</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">input_dir</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">output_dir</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">workflow_kind</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'lstchain'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">config_file</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">batch_config</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">debug_mode</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">keep_rta_file</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">slurm_options</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#lstmcpipe.stages.r0_to_dl1" title="Permalink to this definition">¶</a></dt>
<dd><p>R0 to DL1 MC onsite conversion.
Organizes files and launches slurm jobs in two slurm arrays.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>input_dir</strong> (<em>str</em><em> or </em><em>Path</em>) – path to the files directory to analyse</p></li>
<li><p><strong>output_dir</strong> (<em>str</em><em> or </em><em>Path</em>) – Output path to store files</p></li>
<li><p><strong>config_file</strong> (<em>str</em><em> or </em><em>Path</em>) – Path to the {lstchain, ctapipe, HiPeRTA} configuration file</p></li>
<li><p><strong>batch_config</strong> (<em>dict</em>) – Dictionary containing the full (source + env) source_environment and the slurm_account strings.
! NOTE : train_pipe AND dl1_to_dl2 <strong>MUST</strong> be run with the same environment.</p></li>
<li><p><strong>workflow_kind</strong> (<em>str</em>) – One of the supported pipelines. Defines the command to be run on r0 files</p></li>
<li><p><strong>slurm_options</strong> (<em>str</em>) – Extra slurm options to be passed</p></li>
<li><p><strong>ARGUMENTS</strong> (<em># HIPERTA</em>) – </p></li>
<li><p><strong>keep_rta_file</strong> (<em>bool</em>) – Flag to indicate whether to keep (keep_rta_file = True) or remove (keep_rta_file = Flase ) the
<cite>dl1v06_reorganized_*.h5</cite> output file (hiperta_r0_dl1 and re-organiser stages).
Argument to be passed to the hiperta_r0_to_dl1lstchain script.</p></li>
<li><p><strong>debug_mode</strong> (<em>bool</em>) – Flag to activate debug_mode. Only compatible with <cite>hiperta</cite> workflow kind, i.e.,
HiPeRTA functionality. DEFAULT=False.</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p><ul class="simple">
<li><p><strong>jobid2log</strong> (<em>dict</em>) – dictionary log containing {jobid: batch_cmd} information</p></li>
<li><p><em>jobids_r0_dl1</em> – A list of all the jobs sent for input dir</p></li>
</ul>
</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="lstmcpipe.stages.reprocess_dl1">
<span class="sig-prename descclassname"><span class="pre">lstmcpipe.stages.</span></span><span class="sig-name descname"><span class="pre">reprocess_dl1</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">input_dir</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">output_dir</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">workflow_kind</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'lstchain'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">config_file</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">batch_config</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">dl1_files_per_job</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">50</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">slurm_options</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#lstmcpipe.stages.reprocess_dl1" title="Permalink to this definition">¶</a></dt>
<dd><p>Reprocessing of existing dl1 files.
Organizes files and launches slurm jobs in two slurm arrays.
The same train/test split performed with the earlier r0 to dl1
processing is used.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>input_dir</strong> (<em>str</em>) – path to the files directory to analyse</p></li>
<li><p><strong>output_dir</strong> (<em>str</em><em> or </em><em>Path</em>) – Output path to store files</p></li>
<li><p><strong>config_file</strong> (<em>str</em>) – Path to a configuration file. If none is given, the standard configuration of the selected pipeline is applied</p></li>
<li><p><strong>batch_config</strong> (<em>dict</em>) – Dictionary containing the (full) source_environment and the slurm_account strings.
! NOTE : train_pipe AND dl1_to_dl2 <strong>MUST</strong> be run with the same environment.</p></li>
<li><p><strong>workflow_kind</strong> (<em>str</em>) – One of the supported pipelines. Defines the command to be run on r0 files</p></li>
<li><p><strong>dl1_files_per_job</strong> (<em>int</em>) – Number of dl1 files to be processed per job array that was batched.</p></li>
<li><p><strong>slurm_options</strong> (<em>str</em>) – Extra slurm options to be passed to the sbatch command</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p><ul class="simple">
<li><p><strong>jobid2log</strong> (<em>dict</em>) – dictionary log containing {jobid: batch_cmd} information</p></li>
<li><p><em>jobids_dl1_dl1</em> – A list of all the jobs sent for input dir</p></li>
</ul>
</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="lstmcpipe.stages.train_pipe">
<span class="sig-prename descclassname"><span class="pre">lstmcpipe.stages.</span></span><span class="sig-name descname"><span class="pre">train_pipe</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">gamma_dl1_train_file</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">proton_dl1_train_file</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">models_dir</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">config_file</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">batch_configuration</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">''</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">wait_jobs_dl1</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">slurm_options</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#lstmcpipe.stages.train_pipe" title="Permalink to this definition">¶</a></dt>
<dd><p>Train RF from MC DL1 data (onsite LaPalma cluster)</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>gamma_dl1_train_file</strong> (<em>str</em>) – FILE path to the gamma</p></li>
<li><p><strong>proton_dl1_train_file</strong> (<em>str</em>) – FILE path to the proton</p></li>
<li><p><strong>models_dir</strong> – DIR trained models output path</p></li>
<li><p><strong>config_file</strong> (<em>str</em>) – Path to a configuration file. If none is given, a standard configuration is applied</p></li>
<li><p><strong>batch_configuration</strong> (<em>dict</em>) – Dictionary containing the (full) source_environment and the slurm_account strings to be passed to the
sbatch commands
! NOTE : train_pipe AND dl1_to_dl2 MUST BE RUN WITH THE SAME ENVIRONMENT</p></li>
<li><p><strong>wait_jobs_dl1</strong> (<em>str</em>) – A string (of chained job_ids separated by ‘,’ and without spaces between each element), containing
all the job_ids of the merging stage</p></li>
<li><p><strong>slurm_options</strong> (<em>str</em>) – Extra slurm options to be passed to the sbatch command</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p><ul class="simple">
<li><p><strong>log_train</strong> (<em>dict</em>) – dictionary containing the jobid of the batched job as key and the run command (the lstchain_mc_train
command with all its corresponding arguments) as value.</p></li>
<li><p><strong>jobid_train</strong> (<em>str</em>) – jobid of the batched job to be send (for dependencies purposes) to the next stage of the
workflow (onsite_mc_dl1_to_dl2)</p></li>
</ul>
</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="lstmcpipe.stages.train_test_split">
<span class="sig-prename descclassname"><span class="pre">lstmcpipe.stages.</span></span><span class="sig-name descname"><span class="pre">train_test_split</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">input_dir</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">output_dirs</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">batch_configuration</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">wait_jobid_r0_dl1</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">slurm_options</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#lstmcpipe.stages.train_test_split" title="Permalink to this definition">¶</a></dt>
<dd><dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>input_dir</strong> (<em>str</em>) – </p></li>
<li><p><strong>output_dirs</strong> (<em>dict</em>) – </p></li>
<li><p><strong>batch_configuration</strong> (<em>dict</em>) – </p></li>
<li><p><strong>wait_jobid_r0_dl1</strong> (<em>str</em>) – </p></li>
<li><p><strong>slurm_options</strong> (<em>str</em>) – Extra slurm options to be passed to the sbatch command</p></li>
</ul>
</dd>
</dl>
</dd></dl>

</section>
</section>


          </div>
          
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<h1 class="logo"><a href="../index.html">lstmcpipe</a></h1>








<h3>Navigation</h3>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../productions.html">Production list</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pipeline.html">lstmcpipe pipelines</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="lstmcpipe.html">lstmcpipe package</a><ul class="current">
<li class="toctree-l2 current"><a class="reference internal" href="lstmcpipe.html#subpackages">Subpackages</a><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="lstmcpipe.benchmarks.html">lstmcpipe.benchmarks package</a></li>
<li class="toctree-l3"><a class="reference internal" href="lstmcpipe.config.html">lstmcpipe.config package</a></li>
<li class="toctree-l3"><a class="reference internal" href="lstmcpipe.hiperta.html">lstmcpipe.hiperta package</a></li>
<li class="toctree-l3"><a class="reference internal" href="lstmcpipe.io.html">lstmcpipe.io package</a></li>
<li class="toctree-l3"><a class="reference internal" href="lstmcpipe.plots.html">lstmcpipe.plots package</a></li>
<li class="toctree-l3"><a class="reference internal" href="lstmcpipe.scripts.html">lstmcpipe.scripts package</a></li>
<li class="toctree-l3 current"><a class="current reference internal" href="#">lstmcpipe.stages package</a></li>
<li class="toctree-l3"><a class="reference internal" href="lstmcpipe.tests.html">lstmcpipe.tests package</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="lstmcpipe.html#submodules">Submodules</a></li>
<li class="toctree-l2"><a class="reference internal" href="lstmcpipe.html#module-lstmcpipe.logging">lstmcpipe.logging module</a></li>
<li class="toctree-l2"><a class="reference internal" href="lstmcpipe.html#lstmcpipe-lstmcpipe-start-module">lstmcpipe.lstmcpipe_start module</a></li>
<li class="toctree-l2"><a class="reference internal" href="lstmcpipe.html#module-lstmcpipe.utils">lstmcpipe.utils module</a></li>
<li class="toctree-l2"><a class="reference internal" href="lstmcpipe.html#module-lstmcpipe.version">lstmcpipe.version module</a></li>
<li class="toctree-l2"><a class="reference internal" href="lstmcpipe.html#module-lstmcpipe.workflow_management">lstmcpipe.workflow_management module</a></li>
<li class="toctree-l2"><a class="reference internal" href="lstmcpipe.html#module-lstmcpipe">Module contents</a></li>
</ul>
</li>
</ul>

<div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="../index.html">Documentation overview</a><ul>
  <li><a href="lstmcpipe.html">lstmcpipe package</a><ul>
      <li>Previous: <a href="lstmcpipe.scripts.tests.html" title="previous chapter">lstmcpipe.scripts.tests package</a></li>
      <li>Next: <a href="lstmcpipe.tests.html" title="next chapter">lstmcpipe.tests package</a></li>
  </ul></li>
  </ul></li>
</ul>
</div>
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"/>
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script>$('#searchbox').show(0);</script>








        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &copy;Thomas Vuillaume,Enrique Garcia,Lukas Nickel,.  Last updated 28 May 2022 17:34.
      
      |
      Powered by <a href="http://sphinx-doc.org/">Sphinx 4.5.0</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.12</a>
      
      |
      <a href="../_sources/api/lstmcpipe.stages.rst.txt"
          rel="nofollow">Page source</a>
    </div>

    

    
  </body>
</html>